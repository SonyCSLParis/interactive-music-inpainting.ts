@use "mixins/colors.module";
@use "mixins/measures";
@use "mixins/interfaces";
@import 'mixins/imports';

.control-label,
[nexus-ui] {
  text-transform: capitalize;
}

.control-item,
.control-label {
  &,
  * {
    align-self: center;
    align-content: normal;
    align-items: center;
    justify-content: center;
    justify-self: center;
  }
}
.control-item {
  display: inline-grid;
  grid-auto-flow: row;
  grid-auto-columns: 100%;
  select,
  input {
    display: inline-grid;
  }

  svg {
    overflow: visible;
  }
}

.loading-control {
  cursor: wait;

  & * {
    pointer-events: none !important;
  }
}

// #bottom-controls .control-item .fa-solid {
//   font-size: measures.$cycleSelect-size;
// }

#bottom-controls,
#configuration-selection-container {
  [nexus-ui] {
    &,
    > div > div {
      width: fit-content !important;
      height: fit-content !important;
    }
    select,
    input,
    .nexusTextButton {
      width: max-content !important;
      // max-width: 10vw;
      height: max-content !important;
    }
  }
}

#bottom-controls,
#configuration-selection-container {
  [nexus-ui] {
    display: inline-grid;
    max-width: 100%;
    * {
      // border-radius: 0.3em; // 5em;
    }
    > div > div {
      padding: 0.5em !important;
    }

    select,
    input {
      text-align: center;
      font-size: min(7vh, 7vw, 15px) !important;
    }
    select {
      vertical-align: middle;
      top: 50%;
      max-width: 100%;
    }
    input {
      height: min(25px, 10vh) !important;
      width: min(4ch, 10vw) !important;
    }
  }

  border-top-style: solid;

  > .gridspan {
    box-sizing: border-box;
  }
}

.hidden {
  @include interfaces.hiddenControl();
}

.control-label {
  display: flex;
  overflow: hidden;
  white-space: nowrap;
}

#bottom-controls {
  font-size: normal;

  .gridspan .gridspan {
    &,
    *:not(.fa-solid):not(.cycleSelect) {
      font-size: smaller;
    }
  }
  .gridspan .gridspan {
    font-size: smaller;
  }
}

.control-item::after {
  // font-weight: 400;
  // font-size: 1em;
}

#instruments-control-gridspan {
  grid-row: 1;
  grid-column: 3;
}

#instruments-grid {
  grid-template-columns: auto;
  grid-auto-columns: auto;
  grid-auto-flow: column;
}

.gridspan {
  position: relative;
  width: 100%;
  height: 100%;
}

#playback-commands-gridspan {
  grid-row: 1;
  grid-column: 1;

  [class^='.playback-command--stopped'] {
    @include fa-size($fa-size-scale-2xl);
  }
  .playback-command--stopped {
    @include fa-icon-solid($fa-var-play);
  }
  .playback-command--playing {
    @include fa-icon-solid($fa-var-stop);
  }
  .playback-command--waiting {
    @include fa-icon-solid($fa-var-circle-notch);
    opacity: 0.3;
  }
}

#bpm-control-gridspan {
  grid-row: 1;
  grid-column: 4;
}

#download-button-gridspan {
  grid-row: 2;
  grid-column: 1;
}

#constraints-gridspan {
  grid-row: 1;
  grid-column: 3/5;
}

#constraints-container {
  grid-template-columns: 50%;
}

#pitch-control-octave-control input {
  width: max(3ch, 5em) !important;
}

#edit-tools-gridspan {
  grid-row: 1;
  grid-column: 2/3;

  #edit-tool-setup-container {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    column-gap: 5%;

    [nexus-ui] {
      max-width: 100%;
      select {
        max-width: 100%;
      }
    }
  }
}

#midi-input-setup-gridspan {
  grid-row: 2;
  grid-column: 3/5;
}

#midi-output-setup-gridspan {
  grid-row: 2;
  grid-column: 3/4;
  // .gridspan {
  //   grid-template-columns: 85% 15%;
  // }
}

#bottom-controls > .gridspan {
  > :nth-child(2n) {
    width: 90%;
    height: 100%;
    border-radius: 5px;
  }
}

#midi-input-setup-gridspan,
#midi-output-setup-gridspan {
  &.midi-enabled .control-item {
    select,
    input,
    svg {
      filter: invert(1);
    }
  }

  [nexus-ui] select {
    width: 60% !important;
    max-width: unset;
  }
}

#mixing-controls-gridspan {
  grid-row: 2;
  grid-column: 2;
}

#ableton-link-settings-gridspan {
  grid-row: 2;
  grid-column: 4/5;
}

.gridspan {
  align-items: center;
  justify-items: center;

  display: inline-grid;
  grid-template-columns: 100%;
  grid-template-rows: 3fr 1fr;
  grid-auto-flow: column;

  .control-label,
  .control-item {
    flex-basis: auto;
  }
  .gridspan {
    grid-template-columns: auto;
    grid-auto-columns: auto;
  }
}

#bottom-controls .gridspan .gridspan {
  .control-label {
    opacity: 0.8;
  }
  .gridspan .control-label {
    opacity: 0.6;
  }
}

.multi-column-gridspan {
  grid-template-rows: 1fr;
}

// used to display an error message in place of controls,
// e.g. in case of missing Web MIDI API support
// TODO(theis, 2021_04_21): could replace this with actually rendering
// the associated controls, but graying them out/visibly disabling them,
// and offering more info through an info-bubble (with touchscreen support)
$disabled-gridspan-filter: blur(1.3px);

.disabled-gridspan {
  // display: flex;
  color: gray;
  filter: $disabled-gridspan-filter;
  backdrop-filter: $disabled-gridspan-filter;
  // justify-content: center;
  cursor: not-allowed;
  border-radius: 5px;
  * {
    pointer-events: none;
  }
}

@media screen and (max-width: 450px) {
  #pitch-control-container,
  #volume-controls-container {
    grid-template-rows: auto;
    grid-auto-flow: row;
    * {
      max-width: 95%;
    }
  }
  #pitch-control-container {
    .control-label {
      display: none;
    }
  }
  #midi-input-setup-container {
    grid-auto-flow: column;
    grid-template-rows: 1fr 1fr;
    grid-template-columns: 1fr 1fr;
    #midi-input-device-select-container {
      grid-column: 1/3;
    }
  }
}
@media screen and (max-width: 450px) and (min-width: 270px) {
  #pitch-control-container {
    // row-gap: 5%;
  }
  #midi-input-setup-container {
    grid-auto-flow: column;
    grid-template-columns: auto 1fr 1fr;
    #midi-input-device-select-container {
      grid-column: 2/4;
    }
    #midi-input-channel-input-container {
      grid-column: 2;
    }
  }
}
@media screen and (max-width: 270px) {
  #bottom-controls {
    grid-template-rows: 1fr 1fr;
    row-gap: 0.5vh;
  }
  .gridspan {
    grid-template-rows: 1fr;
    padding: 0.25vh 0;
  }
  body.advanced-controls-disabled #bottom-controls {
    grid-template-rows: 1fr;
  }
  .control-label {
    display: none !important;
  }
  #instruments-grid {
    *::after {
      display: none !important;
    }
  }
}

#download-button-interface,
#load-samples-button-interface {
  cursor: pointer;
}

#load-samples-button {
  #load-samples-button-interface {
    @include fa-icon-solid($fa-var-arrow-alt-circle-down);
    @include fa-size($fa-size-scale-2xl);
  }
  &.loading-control {
    #load-samples-button-interface {
      @include fa-icon-solid($fa-var-spinner);
    }
  }
}
